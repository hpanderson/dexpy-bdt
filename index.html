
<html>
<head>
		<meta charset="utf-8">
		<title>dexpy demo</title>
    <link rel="stylesheet" href="reveal.js/css/reveal.css">
    <link rel="stylesheet" href="reveal.js/css/theme/league.css">
		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
</head>
<body>
<div class="reveal">
<div class="slides">

<section data-markdown>
	<textarea data-template>

## Design of Experiments in Python

Hank Anderson

[hank@statease.com](mailto:hank@statease.com)<br>
[https://github.com/hpanderson/dexpy-bdt](https://github.com/hpanderson/dexpy-bdt)

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>

## Agenda

* What is Design of Experiments?
* Design an experiment with <strong>dexpy</strong> to improve the office coffee
* Measure the power of our experiment
* Model the taste test results using <strong>statsmodels</strong>
* Visualize the data with <strong>seaborn</strong> and <strong>matplotlib</strong> to find the best pot of coffee

	</textarea>
</section>

<section>
  <section>

    <h2>What is Design of Experiments (DoE)?</h2>
    <p>A systematic series of tests, in which purposeful changes are made to input factors, so that you may identify causes for significant changes in the output responses.</p>
    <!--<p>NIST has a <a href="http://www.itl.nist.gov/div898/handbook/pri/section1/pri1.htm">nice primer on DOE</a>.</p>-->
    <img src="img/doe_digraph.svg">

  </section>

  <section>

    <h2>History of DOE</h2>
		<img style="float: left;" src="img/fisher.jpg">
    R.A. Fisher<br>
    <ul>
      <li>1919 - Rothamsted Experimental Station</li>
      <li>ANOVA, F-test, null hypothesis</li>
      <li>1935 - The Design of Experiments</li>
      <li>"The Lady Tasting Tea" experiment</li>
    </ul>

  </section>

</section>

<section>
  <section>
    <h1>"Purposeful Changes"</h1>
    <p class="fragment">Correlation != Causation</p>
    <p class="fragment">
      <img src="img/correlation.png"><br>
      <small style="font-size:8;"><a href="http://tylervigen.com/view_correlation?id=97">source</a></small>
    </p>
  </section>
  <section>
    <img src="img/tinfoil_coffee.png">
  </section>
</section>

<section>
  <section data-markdown>
    <textarea data-template>
## What Is It For?

* **Screening Experiments** - Determining which inputs to your system are important
* **Modeling a Process** - Gain a better understanding of your system
* **Optimization** - Find the combination of inputs that results in a better output
* **Robustness** - Find a combination of inputs that produces a consistent result
    </textarea>
  </section>

  <section data-markdown>
    <textarea data-template>
## Examples
* A/B testing of a website
* Allocating marketing budget resources
* Microwave popcorn
    </textarea>
  </section>
</section>

<section data-markdown>
  <textarea data-template>
## DoE in Python: dexpy

* Based on Design-Expert<sup>&reg;</sup> software, a package for design and analysis of industrial experiments
* Apache2 licensed, pure python (for now), available on pypi
* Other alternatives are:
   * [pyDOE](https://github.com/tisimst/pyDOE) (not actively maintained)
   * R [???](https://cran.r-project.org/web/views/ExperimentalDesign.html)
   * [SciDOE](https://forge.scilab.org/index.php/p/scidoe/)
   * [gosset](http://neilsloane.com/gosset/)
   * Proprietary software ($$$) - [Design-Expert](https://www.statease.com), [JMP](https://www.jmp.com), [Minitab](https://www.minitab.com)
  </textarea>
</section>

<section>
	<section data-markdown>
		<textarea data-template>
## Motivating Example: Better Office Coffee

 * Current coffee is subpar ("disgusting and unacceptable")
 * Need to answer the following questions via experimentation:
  * What coffee beans to use?
  * How much coffee to use?
  * How to grind the coffee?
		</textarea>
	</section>

	<section data-markdown>
		<textarea data-template>
## Motivating Example: Better Office Coffee

 * 5 input factors
  * Amount of Coffee (2.5 to 4.0 oz.)
  * Grind size (8-10mm)
  * Brew time (3.5 to 4.5 minutes)
  * Grind Type (burr vs blade)
  * Coffee beans (light vs dark)
 * 1 response: Average overall liking by a panel of 5 office coffee addicts
  * Each taster rates the coffee from 1-9
 * Maximum of 3 taste tests a day, for liability reasons
		</textarea>
	</section>
</section>

<section>
	<section>

		<h3>One Factor at a Time Experimentation</h3>

		<ul>
			<li>Hold all inputs constant, then change one at a time</li>
			<li>Cannot detect interactions, e.g. grind size and amount of coffee have a synergistic relationship</li>
			<li>Inefficient</li>
    </ul>
  </section>

  <section>
    <img src="img/ofat.svg">
	</section>

  <section>
    <img src="img/ofat_3d.svg">
	</section>
</section>

<section>
  <section data-markdown>
    <textarea data-template>
## Factorial Design

* Change multiple inputs at once
* Reveals interactions
* Maximizes information with minimum runs
    </textarea>
  </section>
  <section>
    <img src="img/factorial.svg">
  </section>
  <section>
    <img src="img/factorial_3d.svg">
  </section>
</section>

<section>
  <h2>Statistical Power</h2>

  <p>The probability that a design will detect an active effect.</p>

  <table>
    <thead>
      <tr>
        <th>Effect?</th>
        <th>Retain H<sub>0</sub></th>
        <th>Reject H<sub>0</sub></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>No</strong></td>
        <td>OK</td>
        <td>Type I Error</td>
      </tr>
      <tr>
        <td><strong>Yes</strong></td>
        <td>Type II Error</td>
        <td>OK</td>
      </tr>
    </tbody>
  </table>

  <p>Power is expressed as a probability to detect an effect of size Δ, given noise σ. This is typically given as a delta to sigma ratio Δ/σ. Power is a function of the signal to noise ratio, as well as the number and layout of experiments in the design.</p>
</section>

<section>
  <section>
    <h2>Power Example</h2>
    <p>We taste test 25 pots of coffee with light beans, and 25 pots with dark
    beans. There is a variance of 1.5 taste rating from pot to pot.</p>
    <p>If we expect a 0.5 change in the taste rating when going from light to dark,
    what is the likelihood we would detect it?</p>
  </section>
  <section>
    <img src="img/power_50.svg"><br>
    (Power: <span class="fragment highlight-red">37.86%</span>)
    <br>
    <p style="font-size: 10;">Note: this assumes that we reject H<sub>0</sub> at p <= 0.05</p>
  </section>
</section>

<section>
  <section>
    <h2>Power Example - Increase Delta</h2>
    <p>
      What if we don't care about a taste increase of 0.5? That's not that much better
      than the current coffee, after all. Instead, if we say we only care about a change
      in rating above 2, what is the likelihood we would detect such a change?
    </p>
  </section>
  <section>
    <img src="img/power_50_2.svg"><br>
      (Power: <span class="fragment highlight-green">99.99983%</span>)
  </section>
</section>

<section>
  <section>
    <h2>Power Example - Decrease Noise</h2>
    <p>
      Instead of lowering our standards for our noisy taste ratings, instead
      we could bring in expert testers who have a much more discerning palate.
      These tasters decrease the taste rating variability from 1.5 to 0.75.
    </p>
  </section>
  <section>
    <img src="img/power_50_3.svg"><br>
      (Power: <span class="fragment highlight-green">91%</span>)
  </section>
</section>

<section>
  <section>
    <h2>Power Example - Increase Runs</h2>
    <p>
      If expert testers are too expensive, and we are unwilling to compromise
      our standards, then the only remaining option is to change the experimental
      deisgn. In this toy example, there isn't much we can do other than increase
      the number of pots of coffee from 50 to 200.
    </p>
  </section>
  <section>
    <img src="img/power_50_4.svg"><br>
      (Power: <span class="fragment highlight-green">91.39%</span>)
    <p>
      For more complicated designs changing the structure of the design
      can also increase power.
    </p>
  </section>
</section>

<section>
  <section>
    <h2>Calculating Power with dexpy: OFAT</h2>

    <pre>
      <code data-trim data-noescape>
base_point = [-1, -1, -1, -1, -1]
ofat_points = [base_point]

for i in range(0, 5):
    new_point = base_point[:]
    new_point[i] = 1
    ofat_points.append(new_point)

ofat_df = pd.DataFrame(ofat_points*5,
                       columns=['amount',
                                'grind_size',
                                'brew_time',
                                'grind_type',
                                'beans'])
model = ' + '.join(ofat_df.columns)
ofat_power = dexpy.power.f_power('+'.join(ofat_df.columns),
                                 ofat_df, 2.0, 0.05)
      </code>
    </pre>
  </section>
  <section data-markdown>
    <textarea data-template>
30 total runs, with a signal to noise ratio of 2.

||Power|
|---|---|
|amount|85.85%|
|grind_size|85.85%|
|brew_time|85.85%|
|grind_type|85.85%|
|beans|85.85%|
    </textarea>
  </section>
</section>

<section>
  <section>
    <h2>Calculating Power with dexpy: Factorial</h2>
    <pre>
      <code data-trim data-noescape>
full_design = dexpy.factorial.build_factorial(5, 2**5)
full_design.columns = ['amount',
                       'grind_size',
                       'brew_time',
                       'grind_type',
                       'beans']
model = ' + '.join(full_design.columns)
factorial_power = dexpy.power.f_power(model, full_design, 2.0, 0.05)
      </code>
    </pre>
  </section>

  <section data-markdown>
    <textarea data-template>
32 total runs, with a signal to noise ratio of 2.

||Power|
|---|---|
|amount|99.97%|
|grind_size|99.97%|
|brew_time|99.97%|
|grind_type|99.97%|
|beans|99.97%|
    </textarea>
  </section>
</section>

<section>
  <section data-markdown>
    <textarea data-template>
## Fractional Factorial

* Coffee experiment is 2<sup>5</sup> runs (32)
* We want to add 4 center point runs to check for curvature
* Total runs = 36, 3 per day if all testers are in the office
* Estimate experiment will take a month
    </textarea>
  </section>

  <section data-markdown>
    <textarea data-template>
## Fractional Factorial
* Power for the experiment is > 99%
* Full factorial is overkill
* Instead run 2<sup>5-1</sup> experiments, a "half fraction"
    </textarea>
  </section>
</section>

<section>
  <section>
    <h2>Fractional Factorial</h2>

    <pre>
      <code data-trim data-noescape>
coffee_design = dexpy.factorial.build_factorial(5, 2**(5-1))
coffee_design.columns = ['amount',
                         'grind_size',
                         'brew_time',
                         'grind_type',
                         'beans']
model = ' + '.join(coffee_design.columns)
fractional_power = dexpy.power.f_power(model, coffee_design, 2.0, 0.05)
			</code>
		</pre>
	</section>
  <section>
    <table style="font-size: 16;">
      <thead>
        <tr>
          <th></th>
          <th>amount</th>
          <th>grind_size</th>
          <th>brew_time</th>
          <th>grind_type</th>
          <th>beans</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>2.5</td>
          <td>8</td>
          <td>3.5</td>
          <td>burr</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>1</th>
          <td>2.5</td>
          <td>8</td>
          <td>3.5</td>
          <td>blade</td>
          <td>light</td>
        </tr>
        <tr>
          <th>2</th>
          <td>2.5</td>
          <td>8</td>
          <td>4.5</td>
          <td>burr</td>
          <td>light</td>
        </tr>
        <tr>
          <th>3</th>
          <td>2.5</td>
          <td>8</td>
          <td>4.5</td>
          <td>blade</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>4</th>
          <td>2.5</td>
          <td>10</td>
          <td>3.5</td>
          <td>burr</td>
          <td>light</td>
        </tr>
        <tr>
          <th>5</th>
          <td>2.5</td>
          <td>10</td>
          <td>3.5</td>
          <td>blade</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>6</th>
          <td>2.5</td>
          <td>10</td>
          <td>4.5</td>
          <td>burr</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>7</th>
          <td>2.5</td>
          <td>10</td>
          <td>4.5</td>
          <td>blade</td>
          <td>light</td>
        </tr>
        <tr>
          <th>8</th>
          <td>4</td>
          <td>8</td>
          <td>3.5</td>
          <td>burr</td>
          <td>light</td>
        </tr>
        <tr>
          <th>9</th>
          <td>4</td>
          <td>8</td>
          <td>3.5</td>
          <td>blade</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>10</th>
          <td>4</td>
          <td>8</td>
          <td>4.5</td>
          <td>burr</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>11</th>
          <td>4</td>
          <td>8</td>
          <td>4.5</td>
          <td>blade</td>
          <td>light</td>
        </tr>
        <tr>
          <th>12</th>
          <td>4</td>
          <td>10</td>
          <td>3.5</td>
          <td>burr</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>13</th>
          <td>4</td>
          <td>10</td>
          <td>3.5</td>
          <td>blade</td>
          <td>light</td>
        </tr>
        <tr>
          <th>14</th>
          <td>4</td>
          <td>10</td>
          <td>4.5</td>
          <td>burr</td>
          <td>light</td>
        </tr>
        <tr>
          <th>15</th>
          <td>4</td>
          <td>10</td>
          <td>4.5</td>
          <td>blade</td>
          <td>dark</td>
        </tr>
          <tr>
          <th>16</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>burr</td>
          <td>light</td>
        </tr>
        <tr>
          <th>17</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>burr</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>18</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>blade</td>
          <td>light</td>
        </tr>
        <tr>
          <th>19</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>blade</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>20</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>burr</td>
          <td>light</td>
        </tr>
        <tr>
          <th>21</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>burr</td>
          <td>dark</td>
        </tr>
        <tr>
          <th>22</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>blade</td>
          <td>light</td>
        </tr>
        <tr>
          <th>23</th>
          <td>3.25</td>
          <td>9</td>
          <td>4</td>
          <td>blade</td>
          <td>dark</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>2<sup>(5-1)</sup> Factorial Power</h2>
    <table>
      <thead>
        <tr>
          <th></th>
          <th>Power</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>amount</th>
          <td>96.55%</td>
        </tr>
        <tr>
          <th>grind_size</th>
          <td>96.55%</td>
        </tr>
        <tr>
          <th>brew_time</th>
          <td>96.55%</td>
        </tr>
        <tr>
          <th>grind_type</th>
          <td>99.61%</td>
        </tr>
        <tr>
          <th>beans</th>
          <td>99.61%</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>2<sup>(5-1)</sup> Factorial Power<br>(Interaction Model)</h2>
    <pre>
      <code data-trim data-noescape>
coffee_design = dexpy.factorial.build_factorial(5, 2**(5-1))
coffee_design.columns = ['amount',
                         'grind_size',
                         'brew_time',
                         'grind_type',
                         'beans']
twofi_model = "(" + '+'.join(coffee_design.columns) + ")**2"
fractional_power = dexpy.power.f_power(twofi_model, coffee_design,
                                       2.0, 0.05)
			</code>
		</pre>
  </section>

  <section>
    <h3>2<sup>(5-1)</sup> Factorial Power<br>(Interaction Model)</h3>
    <table style="font-size: 18;">
      <thead>
        <tr>
          <th></th>
          <th>Power</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>amount
          <td>93.67%
        </tr>
        <tr>
          <td>grind_size
          <td>93.67%
        </tr>
        <tr>
          <td>brew_time
          <td>93.67%
        </tr>
        <tr>
          <td>grind_type
          <td>98.91%
        </tr>
        <tr>
          <td>beans
          <td>98.91%
        </tr>
        <tr>
          <td>amount:grind_size
          <td>93.67%
        </tr>
        <tr>
        <td>amount:brew_time
          <td>93.67%
        </tr>
        <tr>
          <td>amount:grind_type
          <td>93.67%
        </tr>
        <tr>
          <td>amount:beans
          <td>93.67%
        </tr>
        <tr>
          <td>grind_size:brew_time
          <td>93.67%
        </tr>
        <tr>
          <td>grind_size:grind_type
          <td>93.67%
        </tr>
        <tr>
          <td>grind_size:beans
          <td>93.67%
        </tr>
        <tr>
          <td>brew_time:grind_type
          <td>93.67%
        </tr>
        <tr>
          <td>brew_time:beans
          <td>93.67%
        </tr>
        <tr>
          <td>grind_type:beans
          <td>98.91%
        </tr>
      </tbody>
    </table>
  </section>
</section>


</div>
</div>
<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.js"></script>
<script>
	Reveal.initialize({
			controls: true,
			progress: true,
			history: true,
			center: true,

			transition: 'slide', // none/fade/slide/convex/concave/zoom

			// Optional reveal.js plugins
			dependencies: [
					{ src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
					{ src: 'reveal.js/plugin/notes/notes.js', async: true }
			]
	});
</script>
</body>
</html>
